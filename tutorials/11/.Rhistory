# Remove objects
rm(list=ls())
detachAllPackages <- function() {
basic.packages <- c("package:stats", "package:graphics", "package:grDevices", "package:utils", "package:datasets", "package:methods", "package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:", search()))==1, TRUE, FALSE)]
package.list <- setdiff(package.list, basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package,  character.only=TRUE)
}
detachAllPackages()
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[,  "Package"])]
if (length(new.pkg))
install.packages(new.pkg,  dependencies = TRUE)
sapply(pkg,  require,  character.only = TRUE)
}
# Load any necessary packages
lapply(c("stargazer","arm","emmeans","ggplot2"),  pkgTest)
getwd()
df <- read.csv("../../datasets/ess_euroscepticism.csv", row.names="X")
is.factor(df$edu_cat)
df$edu_cat <- factor(df$edu_cat
df$edu_cat <- factor(df$edu_cat
is.factor(df$edu_cat)
df$edu_cat
View(df)
df <- read.csv("/Users/poisson/Documents/GitHub/Fork_Statsl Fall2023/datasets/ESS10/ESS10_euroscepticism.csv", row.names="X")
View(df)
df$edu_cat <- factor(df$edu_cat)
is.factor(df$edu_cat)
df$edu_cat
factor(df$edu_cat)
# Complete case analysis
df_na <- df[complete.cases(df), ]
# Education--Categorical independent variable
is.factor(df_na$edu_cat)
model1 <- lm(euftf_re~edu_cat,data=df_na)
summary(model1)
# Change reference category to leaving certificate
levels(df_na$edu_cat) # First level, "Advanced Certificate"
df_na$edu_cat <- relevel(df_na$edu_cat, ref = 4)
summary(model1)
model1 <- lm(euftf_re~edu_cat,data=df_na)
summary(model1)
model1 <- lm(euftf_re~edlvdie,data=df_na)
summary(model1)
# Education--Continuous independent variable
model1 <- lm(euftf_re~edlvdie,data=df_na)
summary(model1)
# Add economic dimension
model_eco <- lm(euftf_re~edlvdie + hinctnta,data=df_na)
summary(model_eco)
# Add political dimension
model_pol <- lm(euftf_re~edlvdie + hinctnta + trstplt, data=df_na)
summary(model_pol)
# Add cultural dimension
model_cul <- lm(euftf_re~edlvdie + hinctnta + trstplt + imwbcnt, data=df_na)
summary(model_cul)
model_final <- lm(euftf_re~edlvdie + hinctnta + trstplt + imwbcnt + gndr + agea + brncntr, data=df_na)
summary(model_final)
stargazer(model1,model_eco,model_pol,model_cul,model_final)
coefplot(model_final) # 95% Confidence intervals (and 50% CIs)
coefplot(model1, add=TRUE, col.pts="gray")
anova(model1, model_eco, test='F')
summary(model_eco)
# Does adding economic dimension improve fit?
anova(model1, model_eco, test='F')
# Does adding political dimension improve fit?
anova(model1, model_pol, test='F')
model5 <- lm(euftf_re~hinctnta + trstplt + imwbcnt, data=df_na)
model6 <- lm(euftf_re~hinctnta + trstplt + imwbcnt + edu_cat, data=df_na)
anova(model5, model6, test='F'
anova(model5, model6, test='F')
anova(model5, model6, test='F')
df_na$gndr <- ifelse(df_na$gndr == 2, 1, 0)
# And convert into factor
df_na$gndr <- factor(df_na$gndr, labels = c("Male", "Female"))
# Fit model
model_int <- lm(euftf_re~edlvdie +
imwbcnt +
gndr +
imwbcnt*gndr, data=df_na)
summary(model_int)
# Or use emmeans package
emtrends(model_int, ~ gndr, var="imwbcnt")
emmip(model_int,
gndr ~ imwbcnt,
at=list(imwbcnt=seq(0,10,by=1), gndr=c("Male","Female"), edlvdie=mean(df_na$edlvdie)),
plotit = TRUE,
CIs = TRUE)
# What does this function do?
emmip(model_int,
gndr ~ imwbcnt,
at=list(imwbcnt=seq(0,10,by=1), gndr=c("Male","Female"), edlvdie=mean(df_na$edlvdie)),
plotit = FALSE,
CIs = TRUE)
7.15015+0.01875*mean(df_ba$edlvdie)-0.47287*0-1.10277*1+0.16751*0*0
# What is the marginal effect of changing gender from male to female, in this scenario?
## 7.15015+0.01875*mean(df_ba$edlvdie)-0.47287*0-1.10277*1+0.16751*0*1
7.15015+0.01875*mean(df_ba$edlvdie)-0.47287*0-1.10277*1+0.16751*0*1
# What is the marginal effect of changing gender from male to female, in this scenario?
## 7.15015+0.01875*mean(df_ba$edlvdie)-0.47287*0-1.10277*1+0.16751*0*1
7.15015+0.01875*mean(df_naa$edlvdie)-0.47287*0-1.10277*1+0.16751*0*1
+0.01875*mean(df_naa$edlvdie)
# Recode dummy variables as 0,1; needed for interactions
df_na$brncntr <- ifelse(df_na$brncntr == 2, 1, 0)
# And convert into factor
df_na$brncntr <- factor(df_na$brncntr, labels = c("Born in country", "Not born in country"))
level(df_na$brncntr)
levels(df_na$brncntr)
df_na$brncntr
# Fit model
model_int2 <- lm(euftf_re~edu_cat +
imwbcnt +
brncntr +
edu_cat*brncntr, data=df_na)
summary(model_int2)
emmip(model_int2,
brncntr ~ edu_cat,
at=list(edu_cat=c("Leaving Certificate","Advanced Certificate","Bachelor Degree","Junior Cycle","Postgraduate Degree"), brncntr=c("Born in country", "Not born in country"), imwbcnt=mean(df_na$imwbcnt)),
plotit = TRUE,
CIs = TRUE)
plot <- ggplot(data=emm, aes(x=edu_cat, y=yvar, fill=brncntr)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(position=position_dodge(.9),width=.25, aes(ymax=UCL, ymin=LCL),alpha=0.3) + # Add error bars
ylab("Predicted level of Euroscepticism") +
xlab("Education levels") +
labs(fill = "Regime type")
emm <- emmip(model_int2,
brncntr ~ edu_cat,
at=list(edu_cat=c("Leaving Certificate","Advanced Certificate","Bachelor Degree","Junior Cycle","Postgraduate Degree"), brncntr=c("Born in country", "Not born in country"), imwbcnt=mean(df_na$imwbcnt)),
plotit = FALSE,
CIs = TRUE)
plot <- ggplot(data=emm, aes(x=edu_cat, y=yvar, fill=brncntr)) +
geom_bar(stat="identity",position="dodge") +
geom_errorbar(position=position_dodge(.9),width=.25, aes(ymax=UCL, ymin=LCL),alpha=0.3) + # Add error bars
ylab("Predicted level of Euroscepticism") +
xlab("Education levels") +
labs(fill = "Regime type")
plot
emm <- emmip(model_int2,
brncntr ~ edu_cat,
at=list(edu_cat=c("Leaving Certificate","Advanced Certificate","Bachelor Degree","Junior Cycle","Postgraduate Degree"), brncntr=c("Born in country", "Not born in country"), imwbcnt=mean(df_na$imwbcnt)),
plotit = FALSE,
CIs = TRUE)
emmip(model_int2,
brncntr ~ edu_cat,
at=list(edu_cat=c("Leaving Certificate","Advanced Certificate","Bachelor Degree","Junior Cycle","Postgraduate Degree"), brncntr=c("Born in country", "Not born in country"), imwbcnt=mean(df_na$imwbcnt)),
plotit = FALSE,
CIs = TRUE)
emmip(model_int2,
brncntr ~ edu_cat,
at=list(edu_cat=c("Leaving Certificate","Advanced Certificate","Bachelor Degree","Junior Cycle","Postgraduate Degree"), brncntr=c("Born in country", "Not born in country"), imwbcnt=mean(df_na$imwbcnt)),
plotit = TRUE,
CIs = TRUE)
